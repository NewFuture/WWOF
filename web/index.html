<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Worker Offloading Test</title>
  <style>
    #connect-info {
      margin: 10px 0;
    }
  </style>
</head><body>

	<h1>Worker Offloading Debug</h1>
	<div style="border: solid 1px;">
		<div>
		Worker URL  <input type="text" id="connect-url" value="http://127.0.0.1/test/repeat.js">
	</div>
	<div>
		Offload Server<input type="text" id="worker-server" value="ws://127.0.0.1:8888">
	</div>
	<button id="btn-create" onclick="init()">建立连接</button>
   <button id="btn-close" onclick="terminate()">断开连接</button>
	</div>



   <div>
   <h4>Post Message to the  offloading worker</h4>
   		<input type="text" id="connect-post">
		<button id="post" onclick="post()">postMessage</button>
   </div>

   <h4>响应数据</h4>
	<div id="connect-info" style="min-height:500px;background-color:pink"></div>
	<script src="offworker.js"></script>
	<script>

    var worker = {};

    function init() {
      var url = document.querySelector('#connect-url').value.trim();
      var server=document.querySelector('#worker-server').value.trim()
      document.querySelector('#connect-info').innerHTML="<b>worker启动</b>"
      worker = new Worker(url,server);
      worker.onmessage = function(event) {
        insertMsg(event.data);
      }
    }

    function insertMsg(txt){
      var con=document.querySelector('#connect-info');
      var newtxt="<div/>"+txt+"</div>"+con.innerHTML;
      con.innerHTML=newtxt;
    }

    function appendMsg(txt) {
      var elem = document.createElement('p');
      elem.innerText = txt;
      document.querySelector('#connect-info').appendChild(elem);
    }

    function post() {
      var msg = document.querySelector('#connect-post').value;
      if(msg && worker) {
        worker.postMessage(msg);
      }
    }

    function terminate() {
      if(worker) {
        worker.close();
        document.querySelector('#connect-info').innerHTML="<b>已停止worker</b>";
      }
    }

	</script>
</body>
</html>
