<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>weboffloading-web-index</title>
  <style>
    #connect-info {
      margin: 10px 0;
    }
  </style>
</head>

<!-- 	<script src="//cdn.bootcss.com/jquery/2.1.2/jquery.min.js"></script>
 -->
<!-- 	<script>
		window.onload = function(){
		var create = $("#connect-create")
		var close = $("#connect-close")
		var close = $("#connect-close")
		var on = $("#connect-on")

		var createBtn = $("#btn-create")
		var closeBtn = $("#btn-close")
		var post = $("#post")


		createBtn.click(function(){
			var  wsServer = 'ws://localhost:8888';
			var  websocket = new WebSocket(wsServer);
			websocket.onopen = function (evt) { onOpen(evt) };
			websocket.onclose = function (evt) { onClose(evt) };
			websocket.onmessage = function (evt) { onMessage(evt) };
			websocket.onerror = function (evt) { onError(evt) };

			function onOpen(evt) {

				console.log("Connected to WebSocket server.");
				create.text("Success connected to WebSocket server...");
				var message = 'hello server';
				var option = {
					cmd: 1,
					data: $("#connect-post").val()
				};
				var msg = JSON.stringify(option);
				websocket.send(msg);

				post.click(function(){
					var text = $("#connect-post").val();
					var url = {
						cmd: 2,
						data: text
					};
					var msg2 = JSON.stringify(url);
					websocket.send(msg2);
				});

			}
			function onClose(evt) {
				console.log("Disconnected");
				close.text("Disconnected")
			}
			function onMessage(evt) {
				var text = on.text() + '>>>>>>>';
				text += ( evt.data )
				on.text(text)
				console.log('Retrieved data from server: ' + evt.data);
			}
			function onError(evt) {
				console.log('Error occured: ' + evt.data);
			};


		})

		/*var socket = io('http://localhost:8888');
		socket.on('news', function (data) {
		  console.log(data);
		  socket.emit('my other event', { my: 'data' });
		});*/
		}
	</script>
 --><body>

	<h1>WorkerOffloading</h1>
  <input type="text" id="connect-url">
	<button id="btn-create" onclick="init()">建立连接</button>
  <button id="btn-close" onclick="terminate()">断开连接</button>
	<div id="connect-info" style="height:300px;background-color:pink"></div>
	<input type="text" id="connect-post">
	<button id="post" onclick="post()">Post</button>
	<script src="offworker.js"></script>
	<script>

    var worker = {};

    function init() {
      var url = document.querySelector('#connect-url').value;
      worker = new offWorker(url);
      worker.onmessage = function(event) {
        appendMsg(event.data);
      }
    }

    function appendMsg(txt) {
      var elem = document.createElement('p');
      elem.innerText = txt;
      document.querySelector('#connect-info').appendChild(elem);
    }

    function post() {
      var msg = document.querySelector('#connect-post').value;
      if(msg && worker) {
        worker.postMessage(msg);
      }
    }

    function terminate() {
      if(worker) {
        worker.close();
      }
    }

	</script>
</body>
</html>
